Exploit Protection is a feature within Windows Defender Exploit Guard that implements the imitgations available in EMET. Exploit Protection was integrated into Windows 10 since version 1709. 

[TOC]

# Exploit Protection mitigation policy file
In an enterprise environment the configuration of the Exploit Protection (EP) mitigations is performed via XML file pushed via GPO or defined in SCCM.

The file follows the schema/structure:
```xml
<MitigationPolicy>
    <AppConfig Executable="AcroRd32.exe">
	    <DEP Enable="true" EmulateAltThunks="false" />
		...
	</AppConfig>
</MitigationPolicy>
```
The section for each application (AppConfig) will repeat with its own mitigations.

# Managing mitigation policy files
This PowerShell module (strictly speaking is not a module) was born from the following needs:
- Compare two different configurations. For example, to get differences from the Microsoft Security Baseline.
- Split the Exploit Protection configuration file into granular files, similarly than the project [sysmon_modular](https://github.com/olafhartong/sysmon-modular). That allows to perform testing of mitigations over a single application or a group of them (category).


## Extracting information
From an Exploit Protection configuration file you will be able to get:
1. Get the list of applications: *Get-EPApps*
2. The list of mitigations for a specific application: *Get-EPAppMitigations*
3. The configuration defined for a specific mitigation to a specific application: *Get-EPAppMitigationConfig*

## Comparing configurations
You can compare two Exploit Protection configuration files and find the difference between:
1. The applications configured: *Compare-EPApps*
2. The mitigations set for a specific application: *Compare-EPAppMitigations*
3. The configuration set for a specific mitigation to a specific application: *Compare-EPAppMitigationConfig*

While the first two are based on the Cmdlet [Compare-Object](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/compare-object?view=powershell-6), the last one is based on the function [Compare-ObjectProperties](https://blogs.technet.microsoft.com/janesays/2017/04/25/compare-all-properties-of-two-objects-in-windows-powershell/), which returns the values of the properties (in this context, the mitigations settings) that differ.

## Merging configurations
This functionality is inspired from the project [PSSysmonTools](https://github.com/mattifestation/PSSysmonTools) from [Matt Graeber](https://twitter.com/mattifestation
) and the [fork](https://github.com/olafhartong/PSSysmonTools) of [Olaf Hartong](https://twitter.com/olafhartong). Taking a reference configuration, it merges all the configuration files contained in a folder and generates the merged configuration.

It also returns the merge operations log where indicates:
- Errors on files: only XML files compliant with the schema are valid, if not they are completely ignored.
- Application (along with the mitigations defined) added or skipped. An application will be skipped if it was already defined previously by another file.

# Removing mitigations
This functionality is inspired from the project of [Gunnar Haslinger](https://hitco.at/): [Windows-Defender-Exploit-Guard-Configuration](https://github.com/gunnarhaslinger/Windows-Defender-Exploit-Guard-Configuration) and the [troubleshooting guide](https://github.com/MicrosoftDocs/windows-itpro-docs/blob/master/windows/security/threat-protection/windows-defender-exploit-guard/troubleshoot-exploit-protection-mitigations.md) in Microsoft Docs. When you really want to remove the settings and not only disable them.

In fact, it is a wrapper of the [last one](ProcessMitigations.ps1), that I extracted from that doc. It allows to remove of a list of applications or directly all of them. If you link the idea of unit testing, you can set mitigations for a specific application or group of them and then you can remove those mitigations. 

Let's imagine that we have a configuration file for Web browsers: *EP-BROWSERS.xml*. First we set the policy, then we test, and finally we want to reset the status.
```powershell
$EPBrowsersPolicyPath = PATH_TO\EP-BROWSERS.xml
# Set the Exploit Protection mitigations.
Set-ProcessMitigation -PolicyPath $EPBrowsersPolicyPath
# Remove the settings aforementioned.
Get-EPApps -ConfigFile $EPBrowsersPolicyPath | select -expandproperty fullname | Remove-EPAppMitigations
```